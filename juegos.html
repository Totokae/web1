<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleta Wavelength Ajustada</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --base-color: #2c3e50;
            --needle-color: #ff4757;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: var(--bg-color);
            font-family: 'Segoe UI', sans-serif;
            user-select: none;
            touch-action: none;
        }

        /* Contenedor principal reducido */
        .game-container {
            position: relative;
            width: 400px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Área de la ruleta reducida */
        .game-view {
            position: absolute;
            top: 0;
            width: 380px;
            height: 190px;
            overflow: hidden;
            border-radius: 190px 190px 0 0;
            background: #fff;
            z-index: 1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .wheel {
            position: absolute;
            top: 0;
            left: 50%;
            width: 360px;
            height: 360px;
            margin-left: -180px;
            border-radius: 50%;
            background: #eee;
            transition: transform 2s cubic-bezier(0.15, 0, 0.15, 1);
        }

        .segment {
            position: absolute;
            top: 0;
            left: 50%;
            width: 30px;
            height: 180px;
            margin-left: -15px;
            transform-origin: bottom center;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 10px;
            font-weight: bold;
            font-size: 18px;
            color: white;
            clip-path: polygon(10% 0, 90% 0, 100% 100%, 0% 100%);
        }

        .p1 { background: #f1c40f; }
        .p3 { background: #e67e22; }
        .p5 { background: #1abc9c; }

        /* Tapa */
        .cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--base-color);
            z-index: 30;
            border-radius: 190px 190px 0 0;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1rem;
            transition: transform 0.6s ease-in-out;
            pointer-events: none;
        }

        .cover.hidden { transform: translateY(110%); }

        /* Vara Roja 360 con seguimiento directo */
        .needle-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            z-index: 40;
            transform: rotate(0deg);
        }

        .needle {
            position: absolute;
            bottom: 0;
            left: -4px;
            width: 8px;
            height: 185px;
            background: var(--needle-color);
            border-radius: 4px;
            cursor: grab;
            box-shadow: 0 0 8px rgba(0,0,0,0.3);
            transform-origin: bottom center;
        }

        .needle::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background: var(--needle-color);
            border-radius: 50%;
        }

        .base-labels {
            width: 380px;
            background: var(--base-color);
            color: white;
            display: flex;
            justify-content: space-between;
            padding: 8px 25px;
            box-sizing: border-box;
            border-radius: 0 0 8px 8px;
            font-weight: bold;
            z-index: 2;
        }

        .controls { margin-top: 20px; }

        button {
            padding: 10px 20px;
            margin: 0 8px;
            border: none;
            border-radius: 6px;
            background: #2980b9;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div class="game-view">
            <div id="cover" class="cover">MODO OCULTO</div>
            <div id="wheel" class="wheel"></div>
        </div>

        <div id="needleWrapper" class="needle-wrapper">
            <div class="needle" id="needle"></div>
        </div>
    </div>

    <div class="base-labels">
        <span>0</span>
        <span>100</span>
    </div>

    <div class="controls">
        <button onclick="spin()">Girar Ruleta</button>
        <button onclick="toggleCover()">Tapar / Ver</button>
    </div>

    <script>
        const wheel = document.getElementById('wheel');
        const cover = document.getElementById('cover');
        const needleWrapper = document.getElementById('needleWrapper');
        const needle = document.getElementById('needle');
        let currentRotation = 0;

        // Distribución simétrica (0° y 180°)
        const scores = [
            [-20, '1', 'p1'], [-10, '3', 'p3'], [0, '5', 'p5'], [10, '3', 'p3'], [20, '1', 'p1'],
            [160, '1', 'p1'], [170, '3', 'p3'], [180, '5', 'p5'], [190, '3', 'p3'], [200, '1', 'p1']
        ];

        scores.forEach(s => {
            const seg = document.createElement('div');
            seg.className = 'segment ' + s[2];
            seg.style.transform = 'rotate(' + s[0] + 'deg)';
            seg.innerText = s[1];
            wheel.appendChild(seg);
        });

        function spin() {
            const randomExtra = Math.floor(Math.random() * 1000) + 720;
            currentRotation += randomExtra;
            wheel.style.transform = 'rotate(' + currentRotation + 'deg)';
        }

        function toggleCover() {
            cover.classList.toggle('hidden');
        }

        // Lógica corregida: Seguimiento directo del cursor
        let isDragging = false;

        const handleMove = (e) => {
            if (!isDragging) return;

            const rect = document.querySelector('.game-container').getBoundingClientRect();
            // El centro de rotación es el centro del contenedor (200, 200 en este caso)
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            // Calculamos el ángulo: Math.atan2(y, x)
            // Restamos la posición del mouse de la posición del centro
            const deltaX = clientX - centerX;
            const deltaY = clientY - centerY;

            // Calculamos grados y ajustamos el offset (90 grados) para que la vara
            // apunte directamente hacia donde está el puntero.
            const radians = Math.atan2(deltaY, deltaX);
            const degrees = radians * (180 / Math.PI) + 90;

            needleWrapper.style.transform = 'rotate(' + degrees + 'deg)';
        };

        needle.addEventListener('mousedown', () => { isDragging = true; needle.style.cursor = 'grabbing'; });
        needle.addEventListener('touchstart', (e) => { isDragging = true; e.preventDefault(); });

        window.addEventListener('mouseup', () => { isDragging = false; needle.style.cursor = 'grab'; });
        window.addEventListener('touchend', () => isDragging = false);
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('touchmove', handleMove, { passive: false });

    </script>
</body>
</html>
