<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador Avanzado del Cubo Binomial (C₁·a + C₂·b)³</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #root {
            width: 100vw;
            height: 100vh;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // ============================================
        // THREE.JS SCENE COMPONENT
        // ============================================
        function Scene3D({ a, b, c1, c2, explosion }) {
            const mountRef = useRef(null);
            const sceneRef = useRef(null);
            const animationFrameRef = useRef(null);

            // Calculate X and Y values
            const X = c1 * a;
            const Y = c2 * b;
            const total = X + Y;

            // Calculate piece positions and geometries
            const pieces = useMemo(() => {
                const halfTotal = total / 2;
                const offset = explosion * 0.8;
                
                // Base positions (when explosion = 0, pieces form perfect cube)
                // Cube X: bottom-left-back corner
                const cubeXBaseX = -halfTotal + X/2;
                const cubeXBaseY = -halfTotal + X/2;
                const cubeXBaseZ = -halfTotal + X/2;
                
                // Prism A along X axis (X² × Y, extends from cube X in +X direction)
                const prismAXBaseX = -halfTotal + X + Y/2;
                const prismAXBaseY = -halfTotal + X/2;
                const prismAXBaseZ = -halfTotal + X/2;
                
                // Prism A along Y axis
                const prismAYBaseX = -halfTotal + X/2;
                const prismAYBaseY = -halfTotal + X + Y/2;
                const prismAYBaseZ = -halfTotal + X/2;
                
                // Prism A along Z axis
                const prismAZBaseX = -halfTotal + X/2;
                const prismAZBaseY = -halfTotal + X/2;
                const prismAZBaseZ = -halfTotal + X + Y/2;
                
                // Prism B at corners (Y² × X)
                const prismBXYBaseX = -halfTotal + X + Y/2;
                const prismBXYBaseY = -halfTotal + X + Y/2;
                const prismBXYBaseZ = -halfTotal + X/2;
                
                const prismBXZBaseX = -halfTotal + X + Y/2;
                const prismBXZBaseY = -halfTotal + X/2;
                const prismBXZBaseZ = -halfTotal + X + Y/2;
                
                const prismBYZBaseX = -halfTotal + X/2;
                const prismBYZBaseY = -halfTotal + X + Y/2;
                const prismBYZBaseZ = -halfTotal + X + Y/2;
                
                // Cube Y: top-right-front corner
                const cubeYBaseX = halfTotal - Y/2;
                const cubeYBaseY = halfTotal - Y/2;
                const cubeYBaseZ = halfTotal - Y/2;

                return [
                    // 1 Cube X
                    {
                        type: 'cubeX',
                        position: [
                            cubeXBaseX - (explosion > 0 ? offset * 0.6 : 0),
                            cubeXBaseY - (explosion > 0 ? offset * 0.6 : 0),
                            cubeXBaseZ - (explosion > 0 ? offset * 0.6 : 0)
                        ],
                        size: [X, X, X],
                        color: 0x3b82f6 // Blue
                    },
                    // 3 Prisms A (X² × Y)
                    {
                        type: 'prismA',
                        position: [
                            prismAXBaseX + (explosion > 0 ? offset * 0.4 : 0),
                            prismAXBaseY - (explosion > 0 ? offset * 0.3 : 0),
                            prismAXBaseZ - (explosion > 0 ? offset * 0.3 : 0)
                        ],
                        size: [Y, X, X],
                        color: 0x8b5cf6 // Purple
                    },
                    {
                        type: 'prismA',
                        position: [
                            prismAYBaseX - (explosion > 0 ? offset * 0.3 : 0),
                            prismAYBaseY + (explosion > 0 ? offset * 0.4 : 0),
                            prismAYBaseZ - (explosion > 0 ? offset * 0.3 : 0)
                        ],
                        size: [X, Y, X],
                        color: 0x8b5cf6
                    },
                    {
                        type: 'prismA',
                        position: [
                            prismAZBaseX - (explosion > 0 ? offset * 0.3 : 0),
                            prismAZBaseY - (explosion > 0 ? offset * 0.3 : 0),
                            prismAZBaseZ + (explosion > 0 ? offset * 0.4 : 0)
                        ],
                        size: [X, X, Y],
                        color: 0x8b5cf6
                    },
                    // 3 Prisms B (Y² × X)
                    {
                        type: 'prismB',
                        position: [
                            prismBXYBaseX + (explosion > 0 ? offset * 0.3 : 0),
                            prismBXYBaseY + (explosion > 0 ? offset * 0.3 : 0),
                            prismBXYBaseZ - (explosion > 0 ? offset * 0.2 : 0)
                        ],
                        size: [Y, Y, X],
                        color: 0x10b981 // Green
                    },
                    {
                        type: 'prismB',
                        position: [
                            prismBXZBaseX + (explosion > 0 ? offset * 0.3 : 0),
                            prismBXZBaseY - (explosion > 0 ? offset * 0.2 : 0),
                            prismBXZBaseZ + (explosion > 0 ? offset * 0.3 : 0)
                        ],
                        size: [Y, X, Y],
                        color: 0x10b981
                    },
                    {
                        type: 'prismB',
                        position: [
                            prismBYZBaseX - (explosion > 0 ? offset * 0.2 : 0),
                            prismBYZBaseY + (explosion > 0 ? offset * 0.3 : 0),
                            prismBYZBaseZ + (explosion > 0 ? offset * 0.3 : 0)
                        ],
                        size: [X, Y, Y],
                        color: 0x10b981
                    },
                    // 1 Cube Y
                    {
                        type: 'cubeY',
                        position: [
                            cubeYBaseX + (explosion > 0 ? offset * 0.6 : 0),
                            cubeYBaseY + (explosion > 0 ? offset * 0.6 : 0),
                            cubeYBaseZ + (explosion > 0 ? offset * 0.6 : 0)
                        ],
                        size: [Y, Y, Y],
                        color: 0xef4444 // Red
                    }
                ];
            }, [X, Y, explosion]);

            useEffect(() => {
                if (!mountRef.current) return;

                // Scene setup
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x1a1a2e);
                sceneRef.current = scene;

                // Camera
                const camera = new THREE.PerspectiveCamera(
                    75,
                    mountRef.current.clientWidth / mountRef.current.clientHeight,
                    0.1,
                    1000
                );
                camera.position.set(10, 10, 10);
                camera.lookAt(0, 0, 0);

                // Renderer
                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                mountRef.current.appendChild(renderer.domElement);

                // Lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                scene.add(directionalLight);

                // Grid helper
                const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x222222);
                scene.add(gridHelper);

                // Axes helper
                const axesHelper = new THREE.AxesHelper(5);
                scene.add(axesHelper);

                // OrbitControls
                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.autoRotate = true;
                controls.autoRotateSpeed = 1.0;
                controls.minDistance = 5;
                controls.maxDistance = 25;

                // Create text labels for axes
                const createTextLabel = (text, position, color = 0xffffff) => {
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = 256;
                    canvas.height = 64;
                    context.fillStyle = `#${color.toString(16).padStart(6, '0')}`;
                    context.font = 'Bold 48px Arial';
                    context.textAlign = 'center';
                    context.textBaseline = 'middle';
                    context.fillText(text, 128, 32);
                    
                    const texture = new THREE.CanvasTexture(canvas);
                    const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
                    const sprite = new THREE.Sprite(spriteMaterial);
                    sprite.position.set(...position);
                    sprite.scale.set(2, 0.5, 1);
                    return sprite;
                };

                // Create pieces
                const pieceMeshes = [];
                const textLabels = [];
                
                const createPiece = (piece) => {
                    const geometry = new THREE.BoxGeometry(...piece.size);
                    const material = new THREE.MeshStandardMaterial({
                        color: piece.color,
                        transparent: true,
                        opacity: 0.85,
                        metalness: 0.3,
                        roughness: 0.7
                    });
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(...piece.position);
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;
                    scene.add(mesh);

                    // Add edges
                    const edges = new THREE.EdgesGeometry(geometry);
                    const line = new THREE.LineSegments(
                        edges,
                        new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 })
                    );
                    line.position.set(...piece.position);
                    scene.add(line);

                    return { mesh, line, piece };
                };

                // Update function
                const updatePieces = () => {
                    // Remove old pieces
                    pieceMeshes.forEach(({ mesh, line }) => {
                        scene.remove(mesh);
                        scene.remove(line);
                        mesh.geometry.dispose();
                        mesh.material.dispose();
                        line.geometry.dispose();
                        line.material.dispose();
                    });
                    pieceMeshes.length = 0;

                    // Remove old text labels
                    textLabels.forEach(label => scene.remove(label));
                    textLabels.length = 0;

                    // Create new pieces
                    pieces.forEach(piece => {
                        const obj = createPiece(piece);
                        pieceMeshes.push(obj);
                    });

                    // Add axis labels
                    const labelX = createTextLabel(`C₁·a = ${X.toFixed(2)}`, [total/2 + 1, 0, 0], 0x3b82f6);
                    const labelY = createTextLabel(`C₂·b = ${Y.toFixed(2)}`, [0, total/2 + 1, 0], 0xef4444);
                    scene.add(labelX);
                    scene.add(labelY);
                    textLabels.push(labelX, labelY);
                };

                updatePieces();

                // Animation loop
                const animate = () => {
                    animationFrameRef.current = requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                };
                animate();

                // Handle resize
                const handleResize = () => {
                    camera.aspect = mountRef.current.clientWidth / mountRef.current.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);
                };
                window.addEventListener('resize', handleResize);

                // Cleanup
                return () => {
                    window.removeEventListener('resize', handleResize);
                    if (animationFrameRef.current) {
                        cancelAnimationFrame(animationFrameRef.current);
                    }
                    pieceMeshes.forEach(({ mesh, line }) => {
                        scene.remove(mesh);
                        scene.remove(line);
                        mesh.geometry.dispose();
                        mesh.material.dispose();
                        line.geometry.dispose();
                        line.material.dispose();
                    });
                    textLabels.forEach(label => scene.remove(label));
                    renderer.dispose();
                    if (mountRef.current && renderer.domElement.parentNode) {
                        mountRef.current.removeChild(renderer.domElement);
                    }
                };
            }, [pieces, X, Y, total]);

            return <div ref={mountRef} className="w-full h-full" />;
        }

        // ============================================
        // MAIN APP COMPONENT
        // ============================================
        function App() {
            const [a, setA] = useState(2.0);
            const [b, setB] = useState(1.5);
            const [c1, setC1] = useState(2);
            const [c2, setC2] = useState(1);
            const [explosion, setExplosion] = useState(0.0);

            // Calculate X and Y
            const X = c1 * a;
            const Y = c2 * b;

            // Calculate coefficients and volumes
            const calculations = useMemo(() => {
                const result1 = Math.pow(c1, 3); // C1³
                const result2 = 3 * Math.pow(c1, 2) * c2; // 3·C1²·C2
                const result3 = 3 * c1 * Math.pow(c2, 2); // 3·C1·C2²
                const result4 = Math.pow(c2, 3); // C2³

                // Volumes
                const volCubeX = Math.pow(X, 3);
                const volPrismA = 3 * Math.pow(X, 2) * Y;
                const volPrismB = 3 * X * Math.pow(Y, 2);
                const volCubeY = Math.pow(Y, 3);
                const totalVolume = Math.pow(X + Y, 3);

                return {
                    result1, result2, result3, result4,
                    volCubeX, volPrismA, volPrismB, volCubeY, totalVolume
                };
            }, [c1, c2, X, Y]);

            return (
                <div className="flex h-screen bg-gray-900 text-white">
                    {/* Left Panel - Controls */}
                    <aside className="w-96 bg-gray-800 border-r border-gray-700 p-6 overflow-y-auto">
                        <h1 className="text-2xl font-bold mb-4 text-yellow-400">
                            Cubo Binomial Avanzado
                        </h1>
                        <div className="text-sm text-gray-400 mb-6">
                            (C₁·a + C₂·b)³
                        </div>

                        {/* Symbolic Formula */}
                        <div className="mb-6 p-4 bg-gray-900 rounded-lg border border-gray-700">
                            <div className="text-sm text-gray-300 mb-2">Fórmula Simbólica:</div>
                            <div className="text-lg font-mono text-yellow-400 text-center">
                                (C₁·a + C₂·b)³
                            </div>
                        </div>

                        {/* Expanded Numerical Formula */}
                        <div className="mb-6 p-4 bg-gray-900 rounded-lg border border-gray-700">
                            <div className="text-sm text-gray-300 mb-2">Fórmula Expandida Numérica:</div>
                            <div className="text-base font-mono text-yellow-400 space-y-1">
                                <div className="text-center">
                                    ({calculations.result1})a³ + ({calculations.result2})a²b + 
                                </div>
                                <div className="text-center">
                                    ({calculations.result3})ab² + ({calculations.result4})b³
                                </div>
                            </div>
                        </div>

                        {/* Slider for 'a' */}
                        <div className="mb-6">
                            <label className="block text-sm font-semibold mb-2 text-gray-300">
                                Variable 'a': <span className="text-yellow-400">{a.toFixed(2)}</span>
                            </label>
                            <input
                                type="range"
                                min="1.0"
                                max="5.0"
                                step="0.1"
                                value={a}
                                onChange={(e) => setA(parseFloat(e.target.value))}
                                className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"
                            />
                            <div className="flex justify-between text-xs text-gray-400 mt-1">
                                <span>1.0</span>
                                <span>5.0</span>
                            </div>
                        </div>

                        {/* Slider for 'b' */}
                        <div className="mb-6">
                            <label className="block text-sm font-semibold mb-2 text-gray-300">
                                Variable 'b': <span className="text-yellow-400">{b.toFixed(2)}</span>
                            </label>
                            <input
                                type="range"
                                min="1.0"
                                max="5.0"
                                step="0.1"
                                value={b}
                                onChange={(e) => setB(parseFloat(e.target.value))}
                                className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"
                            />
                            <div className="flex justify-between text-xs text-gray-400 mt-1">
                                <span>1.0</span>
                                <span>5.0</span>
                            </div>
                        </div>

                        {/* Slider for 'C1' */}
                        <div className="mb-6">
                            <label className="block text-sm font-semibold mb-2 text-gray-300">
                                Coeficiente C₁: <span className="text-yellow-400">{c1}</span>
                            </label>
                            <input
                                type="range"
                                min="1"
                                max="5"
                                step="1"
                                value={c1}
                                onChange={(e) => setC1(parseInt(e.target.value))}
                                className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"
                            />
                            <div className="flex justify-between text-xs text-gray-400 mt-1">
                                <span>1</span>
                                <span>5</span>
                            </div>
                            <div className="text-xs text-gray-500 mt-1">
                                X = C₁·a = {X.toFixed(2)}
                            </div>
                        </div>

                        {/* Slider for 'C2' */}
                        <div className="mb-6">
                            <label className="block text-sm font-semibold mb-2 text-gray-300">
                                Coeficiente C₂: <span className="text-yellow-400">{c2}</span>
                            </label>
                            <input
                                type="range"
                                min="1"
                                max="5"
                                step="1"
                                value={c2}
                                onChange={(e) => setC2(parseInt(e.target.value))}
                                className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-red-500"
                            />
                            <div className="flex justify-between text-xs text-gray-400 mt-1">
                                <span>1</span>
                                <span>5</span>
                            </div>
                            <div className="text-xs text-gray-500 mt-1">
                                Y = C₂·b = {Y.toFixed(2)}
                            </div>
                        </div>

                        {/* Explosion Slider */}
                        <div className="mb-6">
                            <label className="block text-sm font-semibold mb-2 text-gray-300">
                                Explosión/Descomposición: <span className="text-yellow-400">{explosion.toFixed(2)}</span>
                            </label>
                            <input
                                type="range"
                                min="0.0"
                                max="3.0"
                                step="0.1"
                                value={explosion}
                                onChange={(e) => setExplosion(parseFloat(e.target.value))}
                                className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"
                            />
                            <div className="flex justify-between text-xs text-gray-400 mt-1">
                                <span>0.0 (Unido)</span>
                                <span>3.0 (Explotado)</span>
                            </div>
                        </div>

                        {/* Detailed Volume Table */}
                        <div className="mb-6">
                            <h2 className="text-lg font-semibold mb-3 text-yellow-400">Tabla Detallada de Volúmenes</h2>
                            <div className="bg-gray-900 rounded-lg border border-gray-700 overflow-hidden">
                                <table className="w-full text-xs">
                                    <thead className="bg-gray-800">
                                        <tr>
                                            <th className="px-2 py-2 text-left text-gray-300">Componente</th>
                                            <th className="px-2 py-2 text-left text-gray-300">Fórmula Geométrica</th>
                                            <th className="px-2 py-2 text-left text-gray-300">Cálculo Parcial</th>
                                            <th className="px-2 py-2 text-right text-gray-300">Volumen Total</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-gray-400">
                                        <tr className="border-t border-gray-700">
                                            <td className="px-2 py-2">
                                                <div className="flex items-center gap-1">
                                                    <div className="w-3 h-3 rounded bg-blue-500"></div>
                                                    <span>1 Cubo X</span>
                                                </div>
                                            </td>
                                            <td className="px-2 py-2 font-mono text-xs">X³</td>
                                            <td className="px-2 py-2 font-mono text-xs">({X.toFixed(2)})³</td>
                                            <td className="px-2 py-2 text-right text-yellow-400 font-bold">
                                                {calculations.volCubeX.toFixed(3)}
                                            </td>
                                        </tr>
                                        <tr className="border-t border-gray-700">
                                            <td className="px-2 py-2">
                                                <div className="flex items-center gap-1">
                                                    <div className="w-3 h-3 rounded bg-purple-500"></div>
                                                    <span>3 Prismas A</span>
                                                </div>
                                            </td>
                                            <td className="px-2 py-2 font-mono text-xs">3·X²·Y</td>
                                            <td className="px-2 py-2 font-mono text-xs">3·({X.toFixed(2)})²·({Y.toFixed(2)})</td>
                                            <td className="px-2 py-2 text-right text-yellow-400 font-bold">
                                                {calculations.volPrismA.toFixed(3)}
                                            </td>
                                        </tr>
                                        <tr className="border-t border-gray-700">
                                            <td className="px-2 py-2">
                                                <div className="flex items-center gap-1">
                                                    <div className="w-3 h-3 rounded bg-green-500"></div>
                                                    <span>3 Prismas B</span>
                                                </div>
                                            </td>
                                            <td className="px-2 py-2 font-mono text-xs">3·X·Y²</td>
                                            <td className="px-2 py-2 font-mono text-xs">3·({X.toFixed(2)})·({Y.toFixed(2)})²</td>
                                            <td className="px-2 py-2 text-right text-yellow-400 font-bold">
                                                {calculations.volPrismB.toFixed(3)}
                                            </td>
                                        </tr>
                                        <tr className="border-t border-gray-700">
                                            <td className="px-2 py-2">
                                                <div className="flex items-center gap-1">
                                                    <div className="w-3 h-3 rounded bg-red-500"></div>
                                                    <span>1 Cubo Y</span>
                                                </div>
                                            </td>
                                            <td className="px-2 py-2 font-mono text-xs">Y³</td>
                                            <td className="px-2 py-2 font-mono text-xs">({Y.toFixed(2)})³</td>
                                            <td className="px-2 py-2 text-right text-yellow-400 font-bold">
                                                {calculations.volCubeY.toFixed(3)}
                                            </td>
                                        </tr>
                                        <tr className="border-t-2 border-yellow-400 bg-gray-800">
                                            <td colSpan="3" className="px-2 py-2 font-semibold text-gray-200">
                                                Total (X + Y)³
                                            </td>
                                            <td className="px-2 py-2 text-right text-yellow-400 font-bold text-base">
                                                {calculations.totalVolume.toFixed(3)}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Legend */}
                        <div className="text-xs text-gray-400 space-y-2">
                            <p className="font-semibold text-gray-300 mb-2">Leyenda de Colores:</p>
                            <div className="flex items-center gap-2">
                                <div className="w-3 h-3 rounded bg-blue-500"></div>
                                <span>1 Cubo X (lado = C₁·a)</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-3 h-3 rounded bg-purple-500"></div>
                                <span>3 Prismas A (X² × Y)</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-3 h-3 rounded bg-green-500"></div>
                                <span>3 Prismas B (Y² × X)</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-3 h-3 rounded bg-red-500"></div>
                                <span>1 Cubo Y (lado = C₂·b)</span>
                            </div>
                        </div>
                    </aside>

                    {/* Right Panel - 3D Scene */}
                    <main className="flex-1 relative">
                        <Scene3D a={a} b={b} c1={c1} c2={c2} explosion={explosion} />
                    </main>
                </div>
            );
        }

        // Render app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

